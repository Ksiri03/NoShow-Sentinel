# Frontend Documentation: Smart Medical Appointment No-Show Predictor

## 1. Overview

This document provides a comprehensive, A-to-Z guide to the frontend of the **Smart Medical Appointment No-Show Predictor**. The application is a single-page web dashboard designed to help healthcare administrators predict the likelihood of a patient missing their scheduled medical appointment.

The user interface (UI) is designed to be modern, responsive, and intuitive. It allows users to input patient data, receive a real-time risk prediction, understand the factors driving that prediction, and simulate different scenarios.

**Key Goals of the Frontend:**
- Provide a clean, user-friendly interface for making no-show predictions.
- Clearly visualize the prediction results, including probability, key influencing factors, and recommended actions.
- Enable interactive "what-if" analysis through a simulation mode.
- Offer a historical view of prediction trends over time.
- Ensure the application is responsive and accessible across devices (desktop, tablet, and mobile).

---

## 2. Technology Stack

The frontend is built with a modern, component-based architecture using the following technologies:

- **Framework:** Next.js (v15+) with the App Router.
- **Language:** TypeScript.
- **UI Library:** React (v18+).
- **Styling:** Tailwind CSS for utility-first styling, integrated with ShadCN UI.
- **UI Components:** ShadCN UI, a collection of beautifully designed, accessible, and customizable components (e.g., Cards, Forms, Buttons, Dialogs).
- **Icons:** Lucide React for a clean and consistent icon set.
- **Charts:** Recharts for creating responsive charts and graphs (used on the History page).
- **Form Management:** React Hook Form for efficient and scalable form state management and validation.
- **Schema Validation:** Zod for defining schemas and validating form data.
- **AI/Backend Communication:** Asynchronous `fetch` calls to Genkit flows deployed as server-side Next.js actions.

---

## 3. Project Structure

The codebase is organized into the following key directories within the `src/` folder:

- **`src/app/`**: Contains the main pages and layouts of the application, following the Next.js App Router convention.
  - `page.tsx`: The main Dashboard page.
  - `history/page.tsx`: The Prediction History page.
  - `layout.tsx`: The root layout for the entire application, including the header and toaster notifications.
  - `globals.css`: Global styles and Tailwind CSS configuration, including the application's color theme (CSS variables).
- **`src/components/`**: Contains all reusable React components.
  - `dashboard/`: Components specific to the main prediction dashboard (e.g., `PredictionForm`, `PredictionResults`, `AuditLog`).
  - `ui/`: Core ShadCN UI components (e.g., `Button`, `Card`, `Input`).
- **`src/lib/`**: Contains utility functions, type definitions, and application-wide logic.
  - `schema.ts`: Zod schema for validating the prediction form.
  - `types.ts`: TypeScript type definitions for objects like `AuditLogEntry`.
  - `utils.ts`: Utility functions, most notably `cn()` for merging Tailwind CSS classes.
- **`src/hooks/`**: Contains custom React hooks.
  - `use-toast.ts`: Hook for managing toast notifications.
  - `use-mobile.ts`: Hook to detect if the user is on a mobile device.
  - `use-debounce.ts`: Hook for debouncing input values, used in the simulation mode.
- **`src/ai/`**: Contains Genkit flows for communicating with the AI backend.
  - `flows/`: Contains the specific flows that the frontend calls (e.g., `explainablePrediction`).

---

## 4. Core Pages & Layouts

### 4.1. Root Layout (`src/app/layout.tsx`)

This is the main shell of the application. It is responsible for:
- Setting the HTML document structure (`<html>`, `<body>`).
- Importing global stylesheets (`globals.css`) and fonts (Inter).
- Rendering the `Header` component, which is present on all pages.
- Rendering the main content area where pages are displayed (`{children}`).
- Providing a `Toaster` component for displaying app-wide notifications (e.g., errors, success messages).

### 4.2. Dashboard Page (`src/app/page.tsx`)

This is the main landing page and the core of the application.

**Layout:**
- **Desktop:** A two-column layout.
  - The left column (`lg:col-span-1`) contains the `PredictionForm` within a `Card` component. It remains sticky on the screen for easy access while scrolling through results.
  - The right column (`lg:col-span-2`) is the main content area, displaying the prediction analysis.
- **Mobile:** A single-column layout.
  - The `PredictionForm` is collapsed within an `Accordion` to save space. The user can tap to expand it.
  - The prediction analysis is displayed below the form accordion.

**State Management:**
- `isLoading`: A boolean state to track when an API call is in progress. This is used to show/hide the `PredictionSkeleton`.
- `prediction`: Stores the result from the AI prediction API. It is `null` initially.
- `auditLog`: An array that stores the last 5 prediction entries.

**Functionality:**
- **`handlePredict`**: An `async` function that is triggered when the form is submitted. It sets `isLoading` to true, calls the `explainablePrediction` AI flow, and updates the `prediction` and `auditLog` state with the results. It includes error handling to show a toast notification if the API call fails.
- **`handleCancel`**: A function passed to the `PredictionSkeleton` to allow canceling a long-running prediction.
- **Conditional Rendering:**
  - If `isLoading` is true, the `PredictionSkeleton` component is shown.
  - If `isLoading` is false and `prediction` has data, the `PredictionResults` component is shown.
  - If `isLoading` is false and `prediction` is `null`, the `NoData` placeholder is shown, prompting the user to submit the form.

### 4.3. History Page (`src/app/history/page.tsx`)

This page provides a historical view of prediction risk over time.

**Layout:**
- A single-column layout with a main heading.
- A `Card` component contains the title, description, and the `HistoryChart`.

**Functionality:**
- The page currently uses a `generateMockData` function to create sample data for the last 30 days. In a production environment, this would be replaced with a hook to fetch real data from a database.
- The `HistoryChart` component is rendered to visualize the `no-show` probability over time.

---

## 5. Component Deep Dive

### 5.1. Header (`src/components/dashboard/header.tsx`)

- **Purpose:** Provides consistent navigation and branding across the app.
- **Features:**
  - **Logo/Branding:** "NoShow Sentinel" title with a stethoscope icon, which links back to the Dashboard page.
  - **Navigation:** Links to "Dashboard" (`/`) and "History" (`/history`). The active link is highlighted based on the current URL path.
  - **Admin Settings:** An `AdminSettings` component, triggered by a settings icon button, which opens a dialog for configuration.

### 5.2. Admin Settings (`src/components/dashboard/admin-settings.tsx`)

- **Purpose:** Allows administrative users to configure model parameters.
- **Features (Dialog-based):**
  - **Auto-Reminders:** A `Switch` to toggle automated reminders for at-risk patients.
  - **Risk Threshold:** A `Slider` to set the probability threshold (e.g., 50%) that determines if a patient is classified as "At Risk".
  - **Save Changes:** A button to persist the settings (currently frontend-only).

### 5.3. Prediction Form (`src/components/dashboard/prediction-form.tsx`)

- **Purpose:** To capture all necessary patient data for a no-show prediction.
- **Implementation:** Uses `react-hook-form` for state management and `zod` for validation via `lib/schema.ts`.
- **Form Fields & Validation:**
  - **Patient ID (optional):** A simple text `Input`.
  - **Age:** A number `Input`. Validated to be between 0 and 120.
  - **Gender:** A `Select` dropdown with "Male", "Female", and "Other" options. It is a required field.
  - **Scheduled & Appointment Dates:** Uses a `Calendar` component within a `Popover` for date selection.
    - **Validation:** Both dates are required. The appointment date must be on or after the scheduled date.
    - **Hydration Safety:** The initial date is set within a `useEffect` hook to prevent server-client mismatches.
  - **Past No-Shows & Comorbidities:** Number `Input` fields, validated to be 0 or greater.
  - **Neighbourhood:** A text `Input`. In a future version, this could be enhanced with an autocomplete feature.
  - **SMS Reminder Sent:** A `Switch` component for a boolean (yes/no) value.
- **Submission & Loading State:**
  - The submit `Button` is disabled and shows a "Predicting..." message with a spinner when `isLoading` is true.
  - Error messages are displayed inline below each field if validation fails.

### 5.4. Prediction Results (`src/components/dashboard/prediction-results.tsx`)

- **Purpose:** To display the complete analysis of a prediction in a clear and actionable format.
- **Sub-components & Features:**
  - **Progress Ring:** A custom SVG component (`ProgressRing`) that visualizes the no-show probability percentage. The color of the ring changes based on the risk level (destructive red for high risk, yellow for medium, and primary blue for low).
  - **Risk Label & Recommended Action:**
    - A `Badge` displays the final verdict: "At Risk of No-Show" or "Likely to Attend".
    - An `Alert` component with a `Lightbulb` icon highlights the `recommended_action` from the API.
  - **Confidence Level:** Shows a "Low," "Medium," or "High" confidence level based on how far the probability is from 50%.
  - **Key Factors:** A `Card` that lists the top 3 features influencing the prediction.
    - An `ArrowUpRight` icon (destructive color) indicates a factor that increased the no-show risk.
    - An `ArrowDownRight` icon (green color) indicates a factor that decreased the no-show risk.
  - **Prediction Explanation:** Displays an AI-generated HTML explanation (`explanation_html`) in a scrollable `div`. A tooltip explains that the content is AI-generated.
  - **Simulation Mode:**
    - A `Card` containing a `Switch` to toggle "Live Update" mode.
    - When enabled, another `PredictionForm` is displayed, pre-filled with the current patient's data.
    - As the user changes the form values, the `onValuesChange` prop triggers.
    - A `useDebounce` hook is used to wait 500ms after the user stops typing before automatically re-submitting the form via `handlePredict`. This provides near real-time feedback without overwhelming the API.
  - **Audit Log:** Renders the `AuditLog` component, passing the last 5 predictions.
  - **Action Buttons:**
    - **Copy JSON:** Copies the full prediction result object to the clipboard.
    - **Download PDF:** A placeholder button that shows a "Coming Soon!" toast.

### 5.5. Audit Log (`src/components/dashboard/audit-log.tsx`)

- **Purpose:** To show a history of the most recent predictions made in the current session.
- **Implementation:** A `Table` component within a `Card`.
- **Columns:**
  - **Patient ID**
  - **Timestamp:** Formatted nicely (e.g., "October 28, 2023 at 2:15 PM").
  - **Risk:** The raw probability percentage.
  - **Prediction:** A `Badge` showing "At Risk" (destructive) or "Likely to Attend" (secondary).

### 5.6. History Chart (`src/components/dashboard/history-chart.tsx`)

- **Purpose:** To visualize historical trends in no-show risk.
- **Implementation:** Uses `recharts` to render a responsive `AreaChart`.
- **Features:**
  - **X-Axis:** Displays the date.
  - **Y-Axis:** Displays the probability percentage.
  - **Area Fill:** A gradient fill under the line graph for better visual appeal.
  - **Custom Tooltip:** A custom tooltip appears on hover, showing the exact date and risk percentage for that data point.

---

## 6. User Flows

### 6.1. Making a Prediction

1.  **User lands on the Dashboard page.** The prediction form is visible on the left (desktop) or in an accordion (mobile). The results panel shows the "Awaiting Patient Data" placeholder.
2.  **User fills out the Prediction Form.** Input validation provides immediate feedback for invalid data (e.g., an age of -5).
3.  **User clicks the "Predict Risk" button.**
4.  The button enters a loading state. The form becomes disabled. The results panel is replaced by the `PredictionSkeleton` component, and a "Cancel Prediction" button appears.
5.  An API call is made to the `explainablePrediction` flow.
6.  Upon receiving a successful response, the `PredictionResults` component is rendered with the data. The skeleton loader disappears.
7.  The new prediction is added to the top of the `auditLog` state.

### 6.2. Using Simulation Mode

1.  After a prediction is made, the user scrolls down to the "Simulation Mode" card in the results panel.
2.  **User toggles the "Live Update" switch.**
3.  A new `PredictionForm` appears, pre-populated with the data from the last prediction.
4.  **User changes an input,** for example, toggling the "SMS Reminder Sent" switch from off to on.
5.  After the user stops interacting for 500ms (due to debouncing), the `handlePredict` function is automatically called with the new form data.
6.  The entire `PredictionResults` panel re-renders with the updated prediction, showing how the change affected the no-show risk.

### 6.3. Viewing Prediction History

1.  **User clicks the "History" link** in the main header.
2.  The application navigates to the `/history` page.
3.  The `HistoryChart` is displayed, showing a graph of no-show risk probability over the last 30 days.
4.  **User can hover over the chart** to see a tooltip with the specific risk percentage for any given day.

---

## 7. API Contract & Data

The frontend communicates with a single primary endpoint, which is implemented as a Genkit flow.

- **Function:** `explainablePrediction(input: ExplainablePredictionInput)`
- **HTTP Equivalent:** `POST /api/predict` (conceptual)

**Request Payload (`ExplainablePredictionInput`):**
A JSON object with the following structure.
```json
{
  "patient_id": "P12345",
  "age": 35,
  "gender": "female",
  "scheduled_iso": "2023-10-28T10:00:00.000Z",
  "appointment_iso": "2023-11-15T14:30:00.000Z",
  "sms_received": true,
  "comorb_count": 2,
  "neighbourhood": "Downtown",
  "past_no_shows": 1
}
```

**Response Payload (`ExplainablePredictionOutput`):**
A JSON object with the following structure.
```json
{
  "probability": 0.78,
  "label": "no-show",
  "top_features": [
    { "name": "Past No-Shows", "contribution": 0.25 },
    { "name": "Neighbourhood", "contribution": 0.15 },
    { "name": "Age", "contribution": -0.05 }
  ],
  "recommended_action": "High-risk patient. Recommend a personalized phone call reminder 24-48 hours before the appointment.",
  "explanation_html": "<div><p>The prediction is primarily driven by a history of <strong>past no-shows</strong>. The patient's neighbourhood also has a higher-than-average no-show rate.</p></div>"
}
```
